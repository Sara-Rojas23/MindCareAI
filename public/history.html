<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Emociones - MindCare AI</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Barra de navegaciÃ³n para usuarios autenticados -->
        <nav id="authNavbar" class="navbar" style="display: none;">
            <div class="navbar-content">
                <div class="navbar-brand">ğŸ§  MindCare AI</div>
                <div class="navbar-menu">
                    <a href="/" class="nav-link">ğŸ“ Diario</a>
                    <a href="habits.html" class="nav-link">ğŸ¯ HÃ¡bitos</a>
                    <a href="history.html" class="nav-link active">ğŸ“Š Historial</a>
                    <a href="manual-usuario.html" class="nav-link" target="_blank">ğŸ“– Manual</a>
                </div>
                <div class="navbar-user">
                    <span id="userWelcome" class="user-welcome">Cargando...</span>
                    <button id="logoutBtn" class="logout-btn">Cerrar SesiÃ³n</button>
                </div>
            </div>
        </nav>

        <!-- Header para usuarios no autenticados (redirigir a login) -->
        <header id="publicHeader" style="display: none;">
            <h1>ğŸ” Acceso Restringido</h1>
            <p>Necesitas iniciar sesiÃ³n para ver tu historial de emociones</p>
            <div class="auth-buttons">
                <a href="login.html" class="auth-link primary">Iniciar SesiÃ³n</a>
            </div>
        </header>

        <main id="historyMain" style="display: none;">
            <!-- Encabezado del historial -->
            <section class="history-header">
                <h1>ğŸ“Š Mi Historial de Emociones</h1>
                <p>Revisa tu progreso emocional y patrones a lo largo del tiempo</p>
            </section>

            <!-- Filtros y controles -->
            <section class="history-controls">
                <div class="controls-row">
                    <div class="filter-group">
                        <label for="periodFilter">PerÃ­odo:</label>
                        <select id="periodFilter">
                            <option value="7">Ãšltimos 7 dÃ­as</option>
                            <option value="30" selected>Ãšltimos 30 dÃ­as</option>
                            <option value="90">Ãšltimos 3 meses</option>
                            <option value="365">Ãšltimo aÃ±o</option>
                            <option value="all">Todo el historial</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="emotionFilter">EmociÃ³n:</label>
                        <select id="emotionFilter">
                            <option value="all">Todas las emociones</option>
                            <option value="alegrÃ­a">ğŸ˜Š AlegrÃ­a</option>
                            <option value="tristeza">ğŸ˜¢ Tristeza</option>
                            <option value="enojo">ğŸ˜  Enojo</option>
                            <option value="miedo">ğŸ˜° Miedo</option>
                            <option value="sorpresa">ğŸ˜® Sorpresa</option>
                            <option value="asco">ğŸ¤¢ Asco</option>
                            <option value="calma">ğŸ˜Œ Calma</option>
                            <option value="estrÃ©s">ğŸ˜« EstrÃ©s</option>
                            <option value="ansiedad">ğŸ˜° Ansiedad</option>
                        </select>
                    </div>
                    
                    <button id="refreshHistory" class="btn-refresh">ğŸ”„ Actualizar</button>
                </div>
            </section>

            <!-- Estado de carga -->
            <div id="loadingState" class="loading-state" style="display: none;">
                <div class="spinner"></div>
                <p>Cargando tu historial...</p>
            </div>

            <!-- Estado vacÃ­o -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-icon">ğŸ“</div>
                <h3>AÃºn no tienes entradas en tu diario</h3>
                <p>Comienza a escribir sobre tus emociones para ver tu progreso aquÃ­.</p>
                <a href="/" class="btn-primary">âœï¸ Escribir mi primera entrada</a>
            </div>

            <!-- Lista de entradas del historial -->
            <section id="historyList" class="history-list" style="display: none;">
                <div class="history-stats">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-info">
                            <div class="stat-number" id="totalEntries">0</div>
                            <div class="stat-label">Entradas totales</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ˜Š</div>
                        <div class="stat-info">
                            <div class="stat-number" id="topEmotion">-</div>
                            <div class="stat-label">EmociÃ³n principal</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“ˆ</div>
                        <div class="stat-info">
                            <div class="stat-number" id="avgConfidence">0%</div>
                            <div class="stat-label">Confianza promedio</div>
                        </div>
                    </div>
                </div>

                <!-- Entradas del historial -->
                <div id="entriesContainer" class="entries-container">
                    <!-- Las entradas se cargarÃ¡n dinÃ¡micamente aquÃ­ -->
                </div>

                <!-- PaginaciÃ³n -->
                <div id="pagination" class="pagination" style="display: none;">
                    <button id="prevPage" class="btn-page" disabled>â† Anterior</button>
                    <span id="pageInfo" class="page-info">PÃ¡gina 1 de 1</span>
                    <button id="nextPage" class="btn-page" disabled>Siguiente â†’</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Modales para mostrar detalles de entradas -->
    <div id="entryModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Detalles de la entrada</h3>
                <button id="closeModal" class="close-btn">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="modalContent">
                    <!-- Contenido de la entrada se carga aquÃ­ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Forzar recarga de scripts sin cachÃ©
        const timestamp = Date.now();
        
        // Cargar utilidades compartidas primero
        const utilsScript = document.createElement('script');
        utilsScript.src = 'shared-utils.js?t=' + timestamp;
        document.body.appendChild(utilsScript);
        
        utilsScript.onload = function() {
            const authScript = document.createElement('script');
            authScript.src = 'mindcare-auth.js?t=' + timestamp;
            document.body.appendChild(authScript);
            
            authScript.onload = function() {
                const historyScript = document.createElement('script');
                historyScript.src = 'history.js?t=' + timestamp;
                document.body.appendChild(historyScript);
            };
        };
    </script>
</body>
</html>